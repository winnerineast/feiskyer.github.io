<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Cloud, Container, Kubernetes, SDN, Docker" />





  <link rel="alternate" href="/atom.xml" title="Feisky's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="Notes about anything.">
<meta property="og:type" content="website">
<meta property="og:title" content="Feisky's Blog">
<meta property="og:url" content="http://feisky.xyz/page/6/index.html">
<meta property="og:site_name" content="Feisky's Blog">
<meta property="og:description" content="Notes about anything.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Feisky's Blog">
<meta name="twitter:description" content="Notes about anything.">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://feisky.xyz/page/6/"/>


  <title> Feisky's Blog </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  


<!-- hexo-inject:begin --><!-- hexo-inject:end --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-69699206-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Feisky's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Notes about anything.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-pages">
          <a href="/pages" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            笔记
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sdn">
          <a href="/sdn" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            SDN网络
          </a>
        </li>
      
        
        <li class="menu-item menu-item-k8s">
          <a href="/k8s" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Kubernetes指南
          </a>
        </li>
      
        
        <li class="menu-item menu-item-ml">
          <a href="/machine-learning" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            机器学习
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/04/Docker-overlay-network-dive/" itemprop="url">
                  Docker overlay network dive
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-04T13:41:54+08:00" content="2016-03-04">
              2016-03-04
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/04/Docker-overlay-network-dive/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/03/04/Docker-overlay-network-dive/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>DON MILLS写的<a href="http://www.singlestoneconsulting.com/blog/2016/january/docker-networking?mkt_tok=3RkMMJWWfF9wsRonuqTMZKXonjHpfsX57usvUK%2B2lMI%2F0ER3fOvrPUfGjI4DS8FjI%2BSLDwEYGJlv6SgFQ7LMMaZq1rgMXBk%3D" target="_blank" rel="external">Docker Multi-Host Networking: Overlays to the Rescue</a>对Docker的overlay network做了细致的分析，<a href="/assets/DockerNetworking2.pdf">值得看一看</a>。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/02/Kubernetes-sig-node-Asia-meeting-nodes/" itemprop="url">
                  Kubernetes sig-node (Asia) meeting notes
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-02T17:07:00+08:00" content="2016-03-02">
              2016-03-02
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/02/Kubernetes-sig-node-Asia-meeting-nodes/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/03/02/Kubernetes-sig-node-Asia-meeting-nodes/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Kubernetes-1-2-Status-Update-dchen"><a href="#Kubernetes-1-2-Status-Update-dchen" class="headerlink" title="Kubernetes 1.2 Status Update (@dchen)"></a>Kubernetes 1.2 Status Update (@dchen)</h2><ul>
<li>Deployment object and HPA scale还有一些P0和P1的问题待解决</li>
<li>aws还有挺多的问题（应该要超过20个）</li>
<li>整个v1.2还有超过100个issue，但大部分都不是block issue</li>
<li>v1.2推荐使用Docker v1.9.1，Docker v1.10 validation <a href="https://github.com/kubernetes/kubernetes/issues/19720" target="_blank" rel="external">https://github.com/kubernetes/kubernetes/issues/19720</a></li>
<li>Docker v1.10最大的问题是镜像格式变化，需要某种转换镜像的管理机制</li>
</ul>
<h2 id="Huawei-Conformance-Test-liangchenye"><a href="#Huawei-Conformance-Test-liangchenye" class="headerlink" title="Huawei Conformance Test (@liangchenye)"></a>Huawei Conformance Test (@liangchenye)</h2><p>关于Pod运行和删除的PR已经merge，但是image的test还在开发中。主要的问题是没有文档指导rkt环境的搭建。</p>
<h2 id="Hyper-integration-feiskyer"><a href="#Hyper-integration-feiskyer" class="headerlink" title="Hyper integration (@feiskyer)"></a>Hyper integration (@feiskyer)</h2><p>Hypernetes e2e test有一个单机环境的<a href="https://gist.github.com/feiskyer/ecb7eab17ef41f134353" target="_blank" rel="external">测试结果</a>，但由于GCE环境的问题，多机环境的搭建还没有完成。还有一个Hyper日志”\n”处理的bug需要修复。</p>
<h2 id="etcd"><a href="#etcd" class="headerlink" title="etcd"></a>etcd</h2><p>etcd计划在4月份发布v3.0 alpha，并争取kubernetes v1.3升级到etcd 3.0 stable。</p>
<h2 id="More-notes-taken-by-lantao"><a href="#More-notes-taken-by-lantao" class="headerlink" title="More notes taken by @lantao"></a>More notes taken by @lantao</h2><p>Release Brain Storm</p>
<p>@hongchao: Over-commit? -&gt; In 1.3 roadmap today, but not finalized.In fact we can do over-commit today, but reliablility and QoS should be guranteed.(@dchen)<br>Detect out of resource<br>Decide which pod should be killed<br>Well-defined eviction policy is needed.</p>
<p>Q&amp;A<br>@dchen: Etcd v3.0 alpha version in April; stable version in May or June; Try to ship with kubernetes 1.3.</p>
<p>@xiang:<br>New node metric api merged? Yeah.<br>Is the new metric api added for better scheduling? No, necessary information for scheduling is available on kubelet side from v1.0.<br>Hardware level metrics?</p>
<p>@feiskyer: Pod level data in cadvisor? At cgroup level, we could do that. But at API level, it is still in disicussion. Internally shareable resource between containers is very powerful but quite complex. If customers don’t ask for that now, we may want to defer it. @dchen: How to define extra overhide of rkt and hyper in api, should it be visible for user?<br>Related issue: <a href="https://github.com/coreos/rkt/issues/1788" target="_blank" rel="external">https://github.com/coreos/rkt/issues/1788</a></p>
<p>Previous notes is recorded at <a href="https://docs.google.com/document/d/1L8s6Nyu5hNJxCOZLqJsuVEFAScWKhbwcis0X-j-upDc/edit#heading=h.jgbd25swf99j" target="_blank" rel="external">https://docs.google.com/document/d/1L8s6Nyu5hNJxCOZLqJsuVEFAScWKhbwcis0X-j-upDc/edit#heading=h.jgbd25swf99j</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/01/10-things-to-avoid-in-docker-containers/" itemprop="url">
                  10 things to avoid in docker containers
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-01T16:33:16+08:00" content="2016-03-01">
              2016-03-01
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/01/10-things-to-avoid-in-docker-containers/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/03/01/10-things-to-avoid-in-docker-containers/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Redhat发布的<a href="https://developerblog.redhat.com/2016/02/24/10-things-to-avoid-in-docker-containers/" target="_blank" rel="external">10 things to avoid in docker containers</a>对于构建基于Container的服务非常有意义。摘录如下：</p>
<blockquote>
<p>1) Don’t store data in containers – A container can be stopped, destroyed, or replaced. An application version 1.0 running in container should be easily replaced by the version 1.1 without any impact or loss of data. For that reason, if you need to store data, store it in a volume, but take care if two containers write data on the same volume because it could cause corruption.  Make sure your applications are designed to write to shared data stores.</p>
</blockquote>
<p>需要持久化的数据存在volume中，这个是共识了。</p>
<blockquote>
<p>2) Don’t ship your application in two pieces – As some people see containers as a virtual machine. Most of them tend to think that they should deploy their application in existing running containers. That can be true during the development phase where you need to deploy and debug continuously; but for a continuous deployment (cd) pipeline in QA and production, your application should be part of the image. Remember: Containers should be immutable.</p>
</blockquote>
<p>无论Container出了啥状况（挂了、要升级了等等），直接干掉并起一个新的。Kubernetes的Replication Controller已经把这个更新过程自动化了。</p>
<blockquote>
<p>3) Don’t create large images – A large image will only make it hard to distribute. Make sure that you have only the required files and libraries to run your application/process. Don’t install unnecessary packages or run “updates” (yum update) during builds.</p>
</blockquote>
<p>镜像尽量做小，分发更为方便。</p>
<blockquote>
<p>4) Don’t use a single layer image – To have a more rational use of the layered filesystem, always create your own base image layer for your OS, another layer for the security and user definition, another layer for the lib installation, another layer for the configuration, and finally another layer for the application. It will be easy to recreate  and manage an image, and easy to distribute.</p>
</blockquote>
<p>镜像分层，更容易维护。如果只有一个layer的话，就没法知道镜像的更新历史了。</p>
<blockquote>
<p>5) Don’t create images from running containers – In other terms, don’t use “docker commit” to create an image. This way to build an image is not reproducible and it’s not versionable, and should be completely avoided. Always use a Dockerfile or any other S2I (source-to-image) approach that is totally reproducible.</p>
</blockquote>
<p>做镜像，Dockerfile是最好的选择。</p>
<blockquote>
<p>6) Don’t use only the “latest” tag – The latest tag is just like the “SNAPSHOT” for Maven users. Tags are encouraged to be used specially when you have a layered filesytem. You don’t want to have surprises when you build your image 2 months later and figure out that your application can’t run because a top layer was replaced by a new version that it’s not backward compatible or because a wrong “latest” version is in the build cache. The latest should also be avoided when deploying containers in production.</p>
</blockquote>
<p>版本问题，时间长了，用latest会出现各种不一致。用固定版本，需要的时候可以升级版本。</p>
<blockquote>
<p>7) Don’t run more than one process in a single container – Containers are perfect to run a single process (http daemon, application server, database), but if you have more than a single process, you will have troubles to manage, get logs, and update them individually.</p>
</blockquote>
<p>为了便于管理、更新和查询日至，每个Container只跑一个进程。</p>
<blockquote>
<p>8) Don’t store credentials in the image. Use environment variables – You don’t want to hardcode any username/password in you image. Use the environment variables to get that information from outside the container. A great example for it is the postgres image.</p>
</blockquote>
<p>敏感数据不要直接放到image中，最好放到环境变量或者volume中。</p>
<blockquote>
<p>9) Run processes with a non-root user – “By default docker containers run as root. (…) As docker matures, more secure default options may become available. For now, requiring root is dangerous for others and may not be available in all environments. Your image should use the USER instruction to specify a non-root user for containers to run as”. (From Guidance for Docker Image Authors)</p>
</blockquote>
<p>安全期间，还是老实用普通用户来允许container吧。最新发布的docker已经支持user namespace了。</p>
<blockquote>
<p>10) Don’t rely on IP addresses – Each container have their own internal IP address and it could change if you start and stop it. If your application or microservices needs to communicate to another container, use any names and/or environment variables to pass the proper information from one container to another.</p>
</blockquote>
<p>Container每次重启，其IP地址都会变化。所以，不要直接依赖IP地址来通信，使用环境变量或者DNS。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/29/Carina-by-Rackspace/" itemprop="url">
                  Carina by Rackspace
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-29T19:20:27+08:00" content="2016-02-29">
              2016-02-29
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/29/Carina-by-Rackspace/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/02/29/Carina-by-Rackspace/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="What-is-Carina"><a href="#What-is-Carina" class="headerlink" title="What is Carina?"></a>What is Carina?</h2><p>Carina is a container runtime environment (currently in Beta) that offers performance, container-native tools, and portability without sacrificing ease of use. You can get started in minutes by using open-source software on managed infrastructure to run your containerized applications.</p>
<p>Your containers run in a bare-metal environment, which avoids the “hypervisor tax” on performance. Applications in this environment launch as much as 20 percent faster and run as much as 60 percent faster. This environment builds on the standard restrictions set out by libcontainer by using an AppArmor profile as an additional security layer to keep your resources isolated.</p>
<p>Carina is built on the open-source Docker Swarm project. It exposes the Docker API, which gives you maximum portability for easily moving applications from development to test and production environments, thus reducing errors and saving time. In the future, other container orchestration environments will be available to you.</p>
<p>You also have access to an intuitive user interface (UI), a command-line interface (CLI), and Carina specific developer tooling, in addition to the ecosystem of tools already compatible with the Docker API. You also have access to a wealth of documentation, from getting started guides to detailed tutorials and best practices. If you need help, you can access community support directly from other developers.</p>
<p>The path from creating a free account (no credit card required) to running a containerized application on a cluster takes under two minutes. You will use open-source software like Docker to compose your applications. And because the infrastructure is managed by Carina, you can take advantage of features like autoscaling. Now you can focus on what is important to you, your business, and your applications.</p>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">brew <span class="keyword">install</span> carina</div><div class="line"><span class="keyword">export</span> CARINA_USERNAME=&lt;email&gt;</div><div class="line"><span class="keyword">export</span> CARINA_APIKEY=&lt;api_key&gt;</div><div class="line"></div><div class="line">carina <span class="keyword">create</span> cluster <span class="comment">--wait --segments=2 --autoscale</span></div><div class="line">carina <span class="keyword">list</span></div><div class="line">eval $(carina env cluster)</div><div class="line"></div><div class="line"># <span class="keyword">Now</span> play <span class="keyword">with</span> docker images</div><div class="line">$ docker run -itd -P nginx</div><div class="line">ebca8aff4badb001912cc119fb58a93d6d2209622ec74404c0643ecbbf31a50a</div><div class="line"># Grab <span class="keyword">public</span> ip <span class="keyword">and</span> ports</div><div class="line">$ docker inspect -f &#123;&#123;.NetworkSettings.Ports&#125;&#125; ebca8aff</div><div class="line"><span class="keyword">map</span>[<span class="number">443</span>/tcp:[&#123;<span class="number">104.130</span><span class="number">.0</span><span class="number">.24</span> <span class="number">32768</span>&#125;] <span class="number">80</span>/tcp:[&#123;<span class="number">104.130</span><span class="number">.0</span><span class="number">.24</span> <span class="number">32769</span>&#125;]]</div></pre></td></tr></table></figure>
<h2 id="Limitations"><a href="#Limitations" class="headerlink" title="Limitations"></a>Limitations</h2><p>For a public container service, Carina of course should only allow containers to run non-privileged processes. For example:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line">$ docker run --rm --privileged busybox</div><div class="line"><span class="attr">Timestamp:</span> <span class="number">2016</span><span class="bullet">-02</span><span class="bullet">-29</span> <span class="number">02</span>:<span class="number">21</span>:<span class="number">29.151360105</span> +<span class="number">0000</span> UTC</div><div class="line"><span class="attr">Code:</span> System error</div><div class="line"></div><div class="line"><span class="attr">Message:</span> permission denied</div><div class="line"></div><div class="line"><span class="attr">Frames:</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="number">0</span>: setupRootfs</div><div class="line"><span class="attr">Package:</span> github.com/opencontainers/runc/libcontainer</div><div class="line"><span class="attr">File:</span> rootfs_linux.go@<span class="number">40</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="number">1</span>: Init</div><div class="line"><span class="attr">Package:</span> github.com/opencontainers/runc/libcontainer.(*linuxStandardInit)</div><div class="line"><span class="attr">File:</span> standard_init_linux.go@<span class="number">57</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="number">2</span>: StartInitialization</div><div class="line"><span class="attr">Package:</span> github.com/opencontainers/runc/libcontainer.(*LinuxFactory)</div><div class="line"><span class="attr">File:</span> factory_linux.go@<span class="number">240</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="number">3</span>: initializer</div><div class="line"><span class="attr">Package:</span> github.com/docker/docker/daemon/execdriver/native</div><div class="line"><span class="attr">File:</span> init.go@<span class="number">35</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="number">4</span>: Init</div><div class="line"><span class="attr">Package:</span> github.com/docker/docker/pkg/reexec</div><div class="line"><span class="attr">File:</span> reexec.go@<span class="number">26</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="number">5</span>: main</div><div class="line"><span class="attr">Package:</span> main</div><div class="line"><span class="attr">File:</span> docker.go@<span class="number">18</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="number">6</span>: main</div><div class="line"><span class="attr">Package:</span> runtime</div><div class="line"><span class="attr">File:</span> proc.go@<span class="number">111</span></div><div class="line"><span class="meta">---</span></div><div class="line"><span class="number">7</span>: goexit</div><div class="line"><span class="attr">Package:</span> runtime</div><div class="line"><span class="attr">File:</span> asm_amd64.s@<span class="number">1721</span></div><div class="line"><span class="attr">docker:</span> Error response from daemon: <span class="number">500</span> Internal Server Error: Container command could not be invoked..</div></pre></td></tr></table></figure>
<p>What interests me is Carina allows your container bind to host network, which means processes in container could monitoring all networks the underlying physical machine:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">docker run -it --rm --net=host  busybox sh</div><div class="line">/ <span class="comment"># hostname</span></div><div class="line">a0b7f5c6<span class="_">-a</span>069-4ed0-b681-adc9ad8<span class="built_in">cd</span>8de-n1</div><div class="line">/ <span class="comment"># ifconfig</span></div><div class="line">docker0   Link encap:Ethernet  HWaddr 02:42:83:02:E7:0C</div><div class="line">          inet addr:172.17.0.1  Bcast:0.0.0.0  Mask:255.255.0.0</div><div class="line">          inet6 addr: fe80::42:83ff:fe02:e70c/64 Scope:Link</div><div class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</div><div class="line">          RX packets:1211 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:1260 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:0</div><div class="line">          RX bytes:579745 (566.1 KiB)  TX bytes:596826 (582.8 KiB)</div><div class="line"></div><div class="line">eth0      Link encap:Ethernet  HWaddr BC:76:4E:20:ED:26</div><div class="line">          inet addr:104.130.0.23  Bcast:104.130.0.255  Mask:255.255.255.0</div><div class="line">          inet6 addr: fe80::be76:4eff:fe20:ed26/64 Scope:Link</div><div class="line">          inet6 addr: 2001:4802:7800:103:be76:4eff:fe20:ed26/64 Scope:Global</div><div class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</div><div class="line">          RX packets:105014 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:74924 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:1000</div><div class="line">          RX bytes:195922683 (186.8 MiB)  TX bytes:10895679 (10.3 MiB)</div><div class="line"></div><div class="line">eth1      Link encap:Ethernet  HWaddr BC:76:4E:20:F5:C3</div><div class="line">          inet addr:10.176.224.183  Bcast:10.176.255.255  Mask:255.255.224.0</div><div class="line">          inet6 addr: fe80::be76:4eff:fe20:f5c3/64 Scope:Link</div><div class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</div><div class="line">          RX packets:7 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:8 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:1000</div><div class="line">          RX bytes:570 (570.0 B)  TX bytes:648 (648.0 B)</div><div class="line"></div><div class="line">lo        Link encap:Local Loopback</div><div class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</div><div class="line">          inet6 addr: ::1/128 Scope:Host</div><div class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</div><div class="line">          RX packets:509058 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:509058 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:0</div><div class="line">          RX bytes:142964399 (136.3 MiB)  TX bytes:142964399 (136.3 MiB)</div><div class="line"></div><div class="line">veth1a257f6 Link encap:Ethernet  HWaddr DE:DC:7D:59:A4:DE</div><div class="line">          inet6 addr: fe80::dcdc:7dff:fe59:a4de/64 Scope:Link</div><div class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</div><div class="line">          RX packets:1161 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:1270 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:0</div><div class="line">          RX bytes:590651 (576.8 KiB)  TX bytes:597163 (583.1 KiB)</div><div class="line">/ <span class="comment"># brctl show</span></div><div class="line">bridge name bridge id       STP enabled interfaces</div><div class="line">docker0     8000.02428302e70c   no      veth1a257f6</div><div class="line">/ <span class="comment"># netstat -anp</span></div><div class="line">Active Internet connections (servers and established)</div><div class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</div><div class="line">tcp        0      0 127.0.0.1:12000         0.0.0.0:*               LISTEN      -</div><div class="line">tcp        0      0 10.176.224.183:12001    0.0.0.0:*               LISTEN      -</div><div class="line">tcp        0      0 10.176.224.183:12002    0.0.0.0:*               LISTEN      -</div><div class="line">tcp        0      0 10.176.224.183:7946     0.0.0.0:*               LISTEN      -</div><div class="line">tcp        0      0 10.176.224.183:8300     0.0.0.0:*               LISTEN      -</div><div class="line">tcp        0      0 127.0.0.1:8400          0.0.0.0:*               LISTEN      -</div><div class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -</div><div class="line">tcp        0      0 127.0.0.1:8600          0.0.0.0:*               LISTEN      -</div><div class="line">tcp        0      0 127.0.0.1:12000         127.0.0.1:57711         ESTABLISHED -</div><div class="line">tcp        0      0 127.0.0.1:12000         127.0.0.1:57808         ESTABLISHED -</div><div class="line">tcp        0      0 127.0.0.1:12000         127.0.0.1:54332         ESTABLISHED -</div><div class="line">tcp        0      0 127.0.0.1:57808         127.0.0.1:12000         ESTABLISHED -</div><div class="line">tcp        0      0 127.0.0.1:57832         127.0.0.1:12000         ESTABLISHED -</div><div class="line">tcp        0      0 127.0.0.1:54335         127.0.0.1:12000         ESTABLISHED -</div><div class="line">tcp        0      0 104.130.0.23:43695      104.130.0.23:42376      ESTABLISHED -</div><div class="line">tcp        0      0 127.0.0.1:12000         127.0.0.1:54335         ESTABLISHED -</div><div class="line">tcp        0      0 127.0.0.1:54328         127.0.0.1:12000         ESTABLISHED -</div><div class="line">tcp        0      0 127.0.0.1:54332         127.0.0.1:12000         ESTABLISHED -</div><div class="line">tcp        0      0 104.130.0.23:43692      104.130.0.23:42376      ESTABLISHED -</div><div class="line">tcp        0      0 127.0.0.1:12000         127.0.0.1:57832         ESTABLISHED -</div><div class="line">tcp        0      0 127.0.0.1:12000         127.0.0.1:54328         ESTABLISHED -</div><div class="line">tcp        0      0 104.130.0.23:43694      104.130.0.23:42376      ESTABLISHED -</div><div class="line">tcp        0      0 104.130.0.23:47207      104.130.0.23:42376      ESTABLISHED -</div><div class="line">tcp        0      0 127.0.0.1:57711         127.0.0.1:12000         ESTABLISHED -</div><div class="line">tcp        0      0 :::32770                :::*                    LISTEN      -</div><div class="line">tcp        0      0 :::2376                 :::*                    LISTEN      -</div><div class="line">tcp        0      0 :::42376                :::*                    LISTEN      -</div><div class="line">tcp        0      0 :::22                   :::*                    LISTEN      -</div><div class="line">tcp        0      0 ::ffff:104.130.0.23:42376 ::ffff:104.130.0.23:47207 ESTABLISHED -</div><div class="line">tcp        0      0 ::ffff:104.130.0.23:42376 ::ffff:104.130.0.23:43694 ESTABLISHED -</div><div class="line">tcp        0   2500 ::ffff:104.130.0.23:2376 ::ffff:139.227.1.228:50333 ESTABLISHED -</div><div class="line">tcp        0      0 ::ffff:104.130.0.23:42376 ::ffff:104.130.0.23:43695 ESTABLISHED -</div><div class="line">tcp        0      0 ::ffff:104.130.0.23:42376 ::ffff:104.130.0.23:43692 ESTABLISHED -</div><div class="line">tcp        0      0 ::ffff:104.130.0.23:2376 ::ffff:139.227.1.228:50332 ESTABLISHED -</div><div class="line">udp        0      0 10.176.224.183:7946     0.0.0.0:*                           -</div><div class="line">udp        0      0 127.0.0.1:8600          0.0.0.0:*                           -</div><div class="line">udp        0      0 10.176.224.183:12001    0.0.0.0:*                           -</div><div class="line">udp        0      0 10.176.224.183:12002    0.0.0.0:*                           -</div><div class="line">Active UNIX domain sockets (servers and established)</div><div class="line">Proto RefCnt Flags       Type       State         I-Node PID/Program name    Path</div><div class="line">unix  2      [ ACC ]     STREAM     LISTENING     1015753155 -                   /var/lib/docker/network/files/33d3542ddd4b10c0411b8c50997cceb8272475bc7a63caeb666e772b57c48a8a.sock</div><div class="line">unix  2      [ ACC ]     STREAM     LISTENING     1015755212 -                   /var/run/docker.sock</div><div class="line">/ <span class="comment"># brctl addbr br0</span></div><div class="line">brctl: bridge br0: Operation not permitted</div></pre></td></tr></table></figure>
<p>Although you couldn’t manage networks (Operation not permitted), but as you see above, containers could obtain many sensitive machine informations. Actually I don’t understand why Rackspace would like to take this risk for public services, or this is just because they are making mistakes. </p>
<p>Though Rackspace makes a different way of CaaS (Run docker bare-metally), Docker itself without hypervisor is still not of security for pulic container services. So all of pulic container services, including AWS ECS, Google GKE, Docker Cloud and so on, are running Docker on virtual machines provided by IaaS.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/26/Docker-Datacenter/" itemprop="url">
                  Docker Datacenter
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-26T17:38:00+08:00" content="2016-02-26">
              2016-02-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/26/Docker-Datacenter/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/02/26/Docker-Datacenter/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Docker annonced <code>Docker Datacenter (DDC)</code> at Februrary 23. It is an integrated, end-to-end platform for agile application development and management from the datacenter to the cloud.</p>
<p>With Docker Datacenter, organizations are empowered to deploy a Containers as a Services (CaaS) on-premises or in your virtual private cloud. A CaaS provides an IT managed and secured application environment of content and infrastructure where developers can build and deploy applications in a self service manner.</p>
<p>DDC includes severial Docker projects:</p>
<ul>
<li>Commercially supported Docker engine</li>
<li>Universal Control Plane (UCP) with embedded Swarm for management and orchestration</li>
<li>Trusted Registry (DTR) for image management</li>
</ul>
<blockquote>
<p>Docker Trusted Registry allows you to store and manage your Docker images on-premise or in your virtual private cloud to support security or regulatory compliance requirements. Simply install and configure Docker Trusted Registry through the web admin console, integrate to your preferred storage, authenticate to your Active Directory / LDAP services and integrate into key software development workflows like Continuous Integration (CI) and Continuous Delivery (CD).</p>
<p>Universal Control Plane enables enterprises to manage and deploy their Dockerized distributed applications, all from within the firewall.</p>
</blockquote>
<p><img src="/images/docker_platform.png" alt=""></p>
<p>DDC conforms to same API with docker and swarm, so it works completely same with <code>docker-compose up</code> on swarm cluster.</p>
<p>The feature of DDC including:</p>
<ul>
<li>Docker native with engine, networking and swarm</li>
<li>Built in HA and security (TLS)</li>
<li>Integrated content security (DTR)</li>
<li>User management</li>
<li>Plugins (networking, volumes, logging)</li>
</ul>
<h3 id="Free-Trial"><a href="#Free-Trial" class="headerlink" title="Free Trial"></a>Free Trial</h3><p>You can get a free trial at <a href="http://www.docker.com/products/docker-datacenter#/demo" target="_blank" rel="external">http://www.docker.com/products/docker-datacenter#/demo</a>. The installation of Docker Datacenter including severial steps:</p>
<ul>
<li>Install commercially supported Docker engine</li>
<li>Install Docker Universal Control Plane (UCP)<ul>
<li>docker run —rm -it -v /var/run/docker.sock:/var/run/docker.sock —name ucp docker/ucp install -i —swarm-port 3376 —host-address $(ifconfig eth0 | awk ‘/inet /{print $2}’ | awk -F: ‘{print $2}’)</li>
<li>Follow the tips and enter the password</li>
<li>Join more nodes: <code>docker run --rm -it -v /var/run/docker.sock:/var/run/docker.sock --name ucp docker/ucp join -i --host-address $(docker-machine ip node2)</code></li>
</ul>
</li>
<li>Install Docker Trusted Registry: <code>docker run docker/trusted-registry install | bash</code></li>
<li>Open ucp dashboard at <a href="https://server-ip" target="_blank" rel="external">https://server-ip</a> and upload your license</li>
</ul>
<p><img src="/images/ucp.png" alt=""></p>
<h3 id="Comparsion-with-kubernetes"><a href="#Comparsion-with-kubernetes" class="headerlink" title="Comparsion with kubernetes"></a>Comparsion with kubernetes</h3><p>DDC provides deep integration with docker tools (docker, swarm, compose). Because most developers are farmiliar with those tools, there is none learning cost for switching to DDC. This is the best advantage of DDC. Other advantages including:</p>
<ul>
<li>Easily to deploy: just a few containers</li>
<li>Docker commercially support</li>
<li>User-friendly UI for managing containers togather</li>
</ul>
<p>On the other side, kubernetes is more difficult to deploy and the dashboard is still on developing at <a href="https://github.com/kubernetes/dashboard" target="_blank" rel="external">https://github.com/kubernetes/dashboard</a>.</p>
<p>There is no official release about what size of cluster DDC can support, while kubernetes has officially cluster size supporting plan for each release.</p>
<p>Kubernetes supports much more features and much more learning curve than DDC.</p>
<p>Both DDC and kubernetes are in the quick evolving way. Currently I think DDC is much more easy to use, but Kubernetes is much more mature for production, because only kubernetes provides the key features like service-discovering, monitoring, logging, replication controllers and so on.</p>
<p>See more at <a href="http://www.docker.com/products/docker-datacenter" target="_blank" rel="external">http://www.docker.com/products/docker-datacenter</a>.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/qrcode.jpg"
               alt="Feisky" />
          <p class="site-author-name" itemprop="name">Feisky</p>
          <p class="site-description motion-element" itemprop="description">Notes about anything.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">93</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/feiskyer" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/feisky" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/371069890" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cnblogs.com/feisky/" target="_blank" title="博客园">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  博客园
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Feisky</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'feiskyblog';
      var disqus_identifier = 'page/6/index.html';
      var disqus_title = "";
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


  


</body>
</html>
