<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Cloud, Container, Kubernetes, SDN, Docker" />





  <link rel="alternate" href="/atom.xml" title="Feisky's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="Notes about anything.">
<meta property="og:type" content="website">
<meta property="og:title" content="Feisky's Blog">
<meta property="og:url" content="http://feisky.xyz/page/8/index.html">
<meta property="og:site_name" content="Feisky's Blog">
<meta property="og:description" content="Notes about anything.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Feisky's Blog">
<meta name="twitter:description" content="Notes about anything.">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://feisky.xyz/page/8/"/>


  <title> Feisky's Blog </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  


<!-- hexo-inject:begin --><!-- hexo-inject:end --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-69699206-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Feisky's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Notes about anything.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sre">
          <a href="/SRE" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            SRE
          </a>
        </li>
      
        
        <li class="menu-item menu-item-ml">
          <a href="/machine-learning" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            机器学习
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sdn">
          <a href="/sdn" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            SDN网络
          </a>
        </li>
      
        
        <li class="menu-item menu-item-pages">
          <a href="/pages" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            读书笔记
          </a>
        </li>
      
        
        <li class="menu-item menu-item-k8s">
          <a href="/k8s" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Kubernetes指南
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/17/Kubernetes-network-policy/" itemprop="url">
                  Kubernetes network policy
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-17T18:53:00+08:00" content="2016-02-17">
              2016-02-17
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/17/Kubernetes-network-policy/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/02/17/Kubernetes-network-policy/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Kubernetes network policy</p>
<p>Kubernetes社区（确切的说是Kubernetes Network SIG [1]）正在讨论Network Policy Proposal，以实现SDN、网络隔离、IP Overlapping等[2]复杂的网络需求。</p>
<p>目前，正在讨论的Proposals有多个：</p>
<ul>
<li><strong>Consolidated Casey/RH Proposal</strong> <a href="https://docs.google.com/document/d/1blfqiH4L_fpn33ZrnQ11v7LcYP0lmpiJ_RaapAPBbNU/edit" target="_blank" rel="external">https://docs.google.com/document/d/1blfqiH4L_fpn33ZrnQ11v7LcYP0lmpiJ_RaapAPBbNU/edit</a></li>
<li>Casey Davenport <a href="https://docs.google.com/document/d/16fg7Dc7K5m4bM2vGwyvkhPG_lcBKeOjaUSYBMwZlR_o/edit?usp=sharing" target="_blank" rel="external">https://docs.google.com/document/d/16fg7Dc7K5m4bM2vGwyvkhPG_lcBKeOjaUSYBMwZlR_o/edit?usp=sharing</a></li>
<li>Vipin Jain <a href="https://docs.google.com/a/insiemenetworks.com/document/d/1KKMOJSXKKQOzlblAzwYV72KGUlAuAaUuFqCWO8h4gd0/edit?usp=sharing" target="_blank" rel="external">https://docs.google.com/a/insiemenetworks.com/document/d/1KKMOJSXKKQOzlblAzwYV72KGUlAuAaUuFqCWO8h4gd0/edit?usp=sharing</a></li>
<li>Tim Hockin <a href="https://docs.google.com/document/d/1bXUO-Lp6smmLm7SMGwrwuvK23wgsaWvx6Mkt-Y0AtZ0/edit#" target="_blank" rel="external">https://docs.google.com/document/d/1bXUO-Lp6smmLm7SMGwrwuvK23wgsaWvx6Mkt-Y0AtZ0/edit#</a></li>
</ul>
<p>这几个Proposal都大同小异，主要的思想都是一致的：</p>
<ul>
<li>默认情况下网络模型跟现在保持一致，只有定义了Network Policy并且实现了相应的Network Plugin的时候，这个Proposal才有意义</li>
<li>Network Policy: 管理网络连通性策略，这些策略与具体的网络实现（如libnetwork等）无关</li>
<li>Network Policy通过Label作用到Pod/Service上</li>
<li>需要Network Plugin配合实现Network Policy</li>
</ul>
<p>下面就以<strong>Consolidated Casey/RH Proposal</strong>为例看看具体的Proposal都有啥。</p>
<h4 id="设计目标"><a href="#设计目标" class="headerlink" title="设计目标"></a>设计目标</h4><ul>
<li>不影响现有的网络架构，即未定义Network Policy时，保持Kubernetes现有的网络架构</li>
<li>基于ThirdPartyResource实现NetworkPolicy资源的管理</li>
</ul>
<h4 id="Namespaces"><a href="#Namespaces" class="headerlink" title="Namespaces"></a>Namespaces</h4><p>Namespace spec中增加<code>isolation</code>，默认关闭。当<code>isolation</code>打开后</p>
<ul>
<li>所有访问该Namespace内部Pods的请求都被拒绝(也包括该Namespace内部的Pods访问内部的其他Pods）</li>
<li>例外：为了不影响Health Check，从Node上访问Pods均允许</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">apiVersion:</span> v1</div><div class="line"><span class="attr">kind:</span> Namespace</div><div class="line"><span class="attr">metadata:</span></div><div class="line"><span class="attr">  name:</span> IsolatedApp</div><div class="line"><span class="attr">spec:</span></div><div class="line"><span class="attr"> isolation:</span> [ <span class="literal">yes</span> | <span class="literal">no</span> ]</div></pre></td></tr></table></figure>
<h4 id="NetworkPolicy-Objects"><a href="#NetworkPolicy-Objects" class="headerlink" title="NetworkPolicy Objects"></a><strong>NetworkPolicy Objects</strong></h4><p>当Namespace的isolation打开的时候，需要NetworkPolicy来控制访问策略。访问策略的规则为：</p>
<ul>
<li>访问策略<code>allowFrom</code>仅对进入的请求有效，当策略满足的时候放行</li>
<li>所有不匹配Policy的入请求均拒绝</li>
<li>所有从Pods向外部发出的请求均放行（当然以后也有可能增加<code>allowTo</code>）</li>
<li>定义Namespace和Pod时需要添加<code>tier</code>标签</li>
</ul>
<p>一个简单的NetworkPolicy示例为</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">kind:</span> NetworkPolicy</div><div class="line"><span class="attr"> metadata:</span></div><div class="line"><span class="attr">  name:</span> database-policy</div><div class="line"><span class="attr">spec:</span></div><div class="line"><span class="attr">  selector:</span></div><div class="line">	 tier: database</div><div class="line"><span class="attr">  allowFrom:</span></div><div class="line">  * namespaces:</div><div class="line">	  foo: bar  [ allows from namespaces with label “foo:bar” ]</div><div class="line">  * pods:</div><div class="line">	  tier: database   [ allows east-west traffic on TCP <span class="number">4001</span> ]</div><div class="line">	protocol: TCP [ One of: TCP, UDP, ICMP ]</div><div class="line">	ports: [<span class="number">4001</span>]</div></pre></td></tr></table></figure>
<h3 id="简单的示例"><a href="#简单的示例" class="headerlink" title="简单的示例"></a>简单的示例</h3><p>现在就看一下如何通过ThirdPartyResource来管理NetworkPolicy资源。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">[root@linux kubernetes]<span class="comment"># # start k8s with thirdpartyresources enabled</span></div><div class="line">[root@linux kubernetes]<span class="comment"># cd $GOPATH/src/k8s.io/kubernetes</span></div><div class="line">[root@linux kubernetes]<span class="comment"># export RUNTIME_CONFIG="extensions/v1beta1=true,extensions/v1beta1/thirdpartyresources=true"</span></div><div class="line">[root@linux kubernetes]<span class="comment"># hack/local-up-cluster.sh</span></div><div class="line"></div><div class="line"></div><div class="line">[root@linux ~]<span class="comment"># # create a ThirdPartyResource whose type is NetworkPolicy</span></div><div class="line">[root@linux ~]<span class="comment"># cat network-policy.yaml</span></div><div class="line">metadata:</div><div class="line">  name: <span class="string">"network-policy.experimental.kubernetes.io"</span></div><div class="line">apiVersion: <span class="string">"extensions/v1beta1"</span></div><div class="line">kind: <span class="string">"ThirdPartyResource"</span></div><div class="line">description: <span class="string">"An experimental specification of network policy"</span></div><div class="line">versions:</div><div class="line">  * name: v1</div><div class="line">[root@linux ~]<span class="comment"># kubectl create -f network-policy.yaml</span></div><div class="line">thirdpartyresource <span class="string">"network-policy.experimental.kubernetes.io"</span> created</div><div class="line">[root@linux ~]<span class="comment"># kubectl get thirdpartyresource</span></div><div class="line">NAME                                        DESCRIPTION                                       VERSION(S)</div><div class="line">network-policy.experimental.kubernetes.io   An experimental specification of network policy   extensions/v1</div><div class="line"></div><div class="line">[root@linux ~]<span class="comment"># # new experimental.kubernetes.io and networkpolicys APIs is visitable</span></div><div class="line">[root@linux ~]<span class="comment"># curl http://localhost:8080/apis/experimental.kubernetes.io/</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"kind"</span>: <span class="string">"APIGroup"</span>,</div><div class="line">  <span class="string">"apiVersion"</span>: <span class="string">"v1"</span>,</div><div class="line">  <span class="string">"name"</span>: <span class="string">"experimental.kubernetes.io"</span>,</div><div class="line">  <span class="string">"versions"</span>: [</div><div class="line">	&#123;</div><div class="line">	  <span class="string">"groupVersion"</span>: <span class="string">"experimental.kubernetes.io/v1"</span>,</div><div class="line">	  <span class="string">"version"</span>: <span class="string">"v1"</span></div><div class="line">	&#125;</div><div class="line">  ],</div><div class="line">  <span class="string">"preferredVersion"</span>: &#123;</div><div class="line">	<span class="string">"groupVersion"</span>: <span class="string">""</span>,</div><div class="line">	<span class="string">"version"</span>: <span class="string">""</span></div><div class="line">  &#125;</div><div class="line">&#125;[root@linux ~]<span class="comment"># curl http://localhost:8080/apis/experimental.kubernetes.io/v1/namespaces/default/networkpolicys/</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"kind"</span>: <span class="string">"NetworkPolicyList"</span>,</div><div class="line">  <span class="string">"items"</span>: [  ]</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">[root@linux ~]<span class="comment"># # create a new network policy</span></div><div class="line">[root@linux ~]<span class="comment"># cat network-policy.json</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"kind"</span>: <span class="string">"NetworkPolicy"</span>,</div><div class="line">  <span class="string">"metadata"</span>: &#123;</div><div class="line">	<span class="string">"name"</span>: <span class="string">"awesome-policy"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"allowIncoming"</span>: &#123;</div><div class="line">	<span class="string">"pods"</span>: [</div><div class="line">	  &#123;</div><div class="line">		<span class="string">"tier"</span>: <span class="string">"database"</span></div><div class="line">	  &#125;</div><div class="line">	],</div><div class="line">	<span class="string">"ports"</span>: [</div><div class="line">	  &#123;</div><div class="line">		<span class="string">"protocol"</span>: <span class="string">"TCP"</span>,</div><div class="line">		<span class="string">"port"</span>: 4001</div><div class="line">	  &#125;</div><div class="line">	],</div><div class="line">	<span class="string">"namespaces"</span>: [</div><div class="line">	  &#123;</div><div class="line">		<span class="string">"foo"</span>: <span class="string">"bar"</span></div><div class="line">	  &#125;</div><div class="line">	]</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"apiVersion"</span>: <span class="string">"experimental.kubernetes.io/v1"</span>,</div><div class="line">  <span class="string">"selector"</span>: &#123;</div><div class="line">	<span class="string">"tier"</span>: <span class="string">"database"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">[root@linux ~]<span class="comment"># # kubectl supporting with 3rd party objects is on reviewing at https://github.com/kubernetes/kubernetes/pull/18835</span></div><div class="line">[root@linux ~]<span class="comment"># # so just post directly here</span></div><div class="line">[root@linux ~]<span class="comment"># curl -X POST -H "Content-Type: application/json" -d @network-policy.json http://localhost:8080/apis/experimental.kubernetes.io/v1/namespaces/default/networkpolicys</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"allowIncoming"</span>: &#123;</div><div class="line">	<span class="string">"namespaces"</span>: [</div><div class="line">	  &#123;</div><div class="line">		<span class="string">"foo"</span>: <span class="string">"bar"</span></div><div class="line">	  &#125;</div><div class="line">	],</div><div class="line">	<span class="string">"pods"</span>: [</div><div class="line">	  &#123;</div><div class="line">		<span class="string">"tier"</span>: <span class="string">"database"</span></div><div class="line">	  &#125;</div><div class="line">	],</div><div class="line">	<span class="string">"ports"</span>: [</div><div class="line">	  &#123;</div><div class="line">		<span class="string">"port"</span>: 4001,</div><div class="line">		<span class="string">"protocol"</span>: <span class="string">"TCP"</span></div><div class="line">	  &#125;</div><div class="line">	]</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"apiVersion"</span>: <span class="string">"experimental.kubernetes.io/v1"</span>,</div><div class="line">  <span class="string">"kind"</span>: <span class="string">"NetworkPolicy"</span>,</div><div class="line">  <span class="string">"metadata"</span>: &#123;</div><div class="line">	<span class="string">"name"</span>: <span class="string">"awesome-policy"</span>,</div><div class="line">	<span class="string">"namespace"</span>: <span class="string">"default"</span>,</div><div class="line">	<span class="string">"selfLink"</span>: <span class="string">"/apis/experimental.kubernetes.io/v1/namespaces/default/networkpolicys/awesome-policy"</span>,</div><div class="line">	<span class="string">"uid"</span>: <span class="string">"63d53b48-d248-11e5-85b1-064a4ed57913"</span>,</div><div class="line">	<span class="string">"resourceVersion"</span>: <span class="string">"29"</span>,</div><div class="line">	<span class="string">"creationTimestamp"</span>: <span class="string">"2016-02-13T11:53:25Z"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"selector"</span>: &#123;</div><div class="line">	<span class="string">"tier"</span>: <span class="string">"database"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">[root@linux ~]<span class="comment"># curl http://localhost:8080/apis/experimental.kubernetes.io/v1/namespaces/default/networkpolicys/</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"kind"</span>: <span class="string">"NetworkPolicyList"</span>,</div><div class="line">  <span class="string">"items"</span>: [</div><div class="line">	&#123;</div><div class="line">	  <span class="string">"allowIncoming"</span>: &#123;</div><div class="line">		<span class="string">"namespaces"</span>: [</div><div class="line">		  &#123;</div><div class="line">			<span class="string">"foo"</span>: <span class="string">"bar"</span></div><div class="line">		  &#125;</div><div class="line">		],</div><div class="line">		<span class="string">"pods"</span>: [</div><div class="line">		  &#123;</div><div class="line">			<span class="string">"tier"</span>: <span class="string">"database"</span></div><div class="line">		  &#125;</div><div class="line">		],</div><div class="line">		<span class="string">"ports"</span>: [</div><div class="line">		  &#123;</div><div class="line">			<span class="string">"port"</span>: 4001,</div><div class="line">			<span class="string">"protocol"</span>: <span class="string">"TCP"</span></div><div class="line">		  &#125;</div><div class="line">		]</div><div class="line">	  &#125;,</div><div class="line">	  <span class="string">"apiVersion"</span>: <span class="string">"experimental.kubernetes.io/v1"</span>,</div><div class="line">	  <span class="string">"kind"</span>: <span class="string">"NetworkPolicy"</span>,</div><div class="line">	  <span class="string">"metadata"</span>: &#123;</div><div class="line">		<span class="string">"name"</span>: <span class="string">"awesome-policy"</span>,</div><div class="line">		<span class="string">"namespace"</span>: <span class="string">"default"</span>,</div><div class="line">		<span class="string">"selfLink"</span>: <span class="string">"/apis/experimental.kubernetes.io/v1/namespaces/default/networkpolicys/awesome-policy"</span>,</div><div class="line">		<span class="string">"uid"</span>: <span class="string">"63d53b48-d248-11e5-85b1-064a4ed57913"</span>,</div><div class="line">		<span class="string">"resourceVersion"</span>: <span class="string">"29"</span>,</div><div class="line">		<span class="string">"creationTimestamp"</span>: <span class="string">"2016-02-13T11:53:25Z"</span></div><div class="line">	  &#125;,</div><div class="line">	  <span class="string">"selector"</span>: &#123;</div><div class="line">		<span class="string">"tier"</span>: <span class="string">"database"</span></div><div class="line">	  &#125;</div><div class="line">	&#125;</div><div class="line">  ]</div><div class="line">&#125;</div><div class="line"></div><div class="line">[root@linux ~]<span class="comment"># # clear</span></div><div class="line">[root@linux ~]<span class="comment"># kubectl delete thirdpartyresource network-policy.experimental.kubernetes.io</span></div><div class="line">thirdpartyresource <span class="string">"network-policy.experimental.kubernetes.io"</span> deleted</div></pre></td></tr></table></figure>
<p>当然了，上面只是API部分的demo，具体的网络Plugin还需要做很多工作实现这些策略。Kubernetes Meetup [3] 上Romana有一个关于Network Policy的演示，[4] 这里有更多的说明。</p>
<p><strong>Consolidated Casey/RH Proposal</strong>还有一些未解决的问题还在讨论中，如</p>
<ul>
<li>Service的访问策略怎么定义，如何处理跟Pod访问策略冲突的问题</li>
<li>如何定义Kubernetes外部服务的访问策略，是不是要在<code>allowFrom</code>中增加<code>CIDR</code>等</li>
</ul>
<p>当然，这些Proposal都还在讨论中，虽然最终的Design和实现还没有确定，但大致的思想肯定不会有太大的变化了。</p>
<p>[1] <a href="https://docs.google.com/document/d/1_w77-zG_Xj0zYvEMfQZTQ-wPP4kXkpGD8smVtW_qqWM" target="_blank" rel="external">https://docs.google.com/document/d/1_w77-zG_Xj0zYvEMfQZTQ-wPP4kXkpGD8smVtW_qqWM</a><br>[2] <a href="https://docs.google.com/document/d/1ZCz_MZILzKCbFwF9gjU1YNA1YbNaw0NDsESh1P6Vcnc" target="_blank" rel="external">https://docs.google.com/document/d/1ZCz_MZILzKCbFwF9gjU1YNA1YbNaw0NDsESh1P6Vcnc</a><br>[3] <a href="https://www.youtube.com/watch?v=ab7mXAddaX8" target="_blank" rel="external">https://www.youtube.com/watch?v=ab7mXAddaX8</a><br>[4] <a href="https://docs.google.com/document/d/1qAm-_oSap-f1d6a-xRTj6xaH1sYQBfK36VyjB5XOZug" target="_blank" rel="external">https://docs.google.com/document/d/1qAm-_oSap-f1d6a-xRTj6xaH1sYQBfK36VyjB5XOZug</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/18/Hypernetes简介-feisky/" itemprop="url">
                  Hypernetes简介 - feisky
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-11-18T17:12:00+08:00" content="2015-11-18">
              2015-11-18
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/11/18/Hypernetes简介-feisky/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/18/Hypernetes简介-feisky/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>【摘要】好久没有更新博客了，今天给大家介绍下最近在Hypernetes上做的工作，这个也是之前在微信群里的一个分享。Hypernetes是一个真正多租户的Kubernetes Distro。Hypernetes在Kubernetes基础上增加了多租户认证授权、容器SDN网络、基于Hyper的容器执行引擎以及… <a href="http://www.cnblogs.com/feisky/p/4975173.html" target="_blank" rel="external">阅读全文</a><img src="http://counter.cnblogs.com/blog/rss/4975173" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/11/hypernetes-wechat-share/" itemprop="url">
                  Hypernetes wechat share
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-11-12T00:00:00+08:00" content="2015-11-12">
              2015-11-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Kubernetes/" itemprop="url" rel="index">
                    <span itemprop="name">Kubernetes</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/11/11/hypernetes-wechat-share/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/11/hypernetes-wechat-share/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天给大家介绍下最近在Hypernetes上做的工作。</p>
<p>Hypernetes是一个真正多租户的Kubernetes Distro。</p>
<p>Hypernetes在Kubernetes基础上增加了多租户认证授权、容器SDN网络、基于Hyper的容器执行引擎以及基于Cinder的持久化存储等。</p>
<p>基本上<code>Hypernetes = Bare-metal + Hyper + Kubernetes + Cinder(Ceph) + Neutron + Keystone</code></p>
<p>在介绍Hypernetes细节之前先首先提一下相关背景，也就是Kubernetes的多租户支持情况。</p>
<p>群里之前已经很多人介绍过Kubernetes了，就不再重复介绍。</p>
<p>这儿主要说一下它在多租户方面的问题。</p>
<p>Kubernetes在多租户方面的支持还是比较少的，没有“租户”这一概念，也只有namespace提供了一个逻辑的资源池（可以给这个namespace设定一些资源的配额），并且它在认证授权、网络、Container Runtime等方面离真正的多租户还都比较远。</p>
<ol>
<li><p>认证方面，虽然支持client certificates，tokens，http basic auth等，但没有用户管理的功能。如果想要新建用户，需要手动修改配置文件并重启服务。最新版本增加了Keystone的认证，可以借助Keystone来管理用户。</p>
</li>
<li><p>授权方面，目前只有AlwaysDeny ，AlwaysAllow以及ABAC模式。ABAC模式根据一个策略文件来配置不同用户的权限，比如限定用户只能访问特定的namespace等，但对于新创建的namespace等资源需要重复修改策略文件。</p>
</li>
<li><p>Kubernetes要求cluster内部所有的容器之间是全通的，而多租户情况下需要不同租户之前网络是隔离的。</p>
</li>
<li><p>Docker的安全性问题，跟虚拟化还是有不少距离。</p>
</li>
</ol>
<p>正是由于上面这些原因，很多公司都在虚拟机里面来跑Kubernetes，比如Google Container Engine、OpenStack Magnum等。</p>
<p>在虚拟机内部跑容器虽然提升了安全性，但也引入了一些问题，比如容器的网络不能通过IaaS层来统一管理，容器无法直接使用IaaS层的持久化存储，无法集中调度所有容器的资源等。所以我们就做了Hypernetes.</p>
<p>先来看一下Hypernetes的架构图</p>
<p><img width="660" alt="2015-11-10 9 23 14" src="https://cloud.githubusercontent.com/assets/676637/11051781/fac21258-878c-11e5-8545-a2b374ee5d70.png"></p>
<p>Hypernetes在Kubernetes基础上增加了一些组件</p>
<p>①增加了Tenant的概念，不同Tenant之间的网络和资源(ns, pod, svc, rc等)是隔离的。这些租户通过keystone管理，并提供认证和授权；<br>②通过Neutron给不同租户提供二层隔离的网络，并支持Neutron的各种插件（目前主要是ovs）；<br>③通过Hyper提供基于虚拟化的容器执行引擎，保证容器的隔离；<br>④还有通过Cinder给容器引入各种持久化存储（目前主要是ceph）</p>
<p>关于OpenStack的各个组件以及Hyper这儿就不再介绍了，群里很多大牛已经介绍过。</p>
<p>具体到Hypernetes内部，详细的架构是这样的</p>
<p><img src="https://github.com/hyperhq/hypernetes/raw/master/architecture.png?raw=true" alt=""></p>
<p>为了支持多租户，Hypernetes基于Kubernetes增加了很多组件，这些组件都是以Plugin的形式提供的。</p>
<p>这样非常方便扩展，也很容易将Hypernetes与现有的IaaS在同一个基础架构上运行起来</p>
<p>比如，如果你不喜欢Neutron，可以把它替换成odl等。</p>
<p>Hypernetes是完全开源的，代码见<a href="https://github.com/hyperhq/hypernetes" target="_blank" rel="external">https://github.com/hyperhq/hypernetes</a></p>
<p>当然，我们也会把Hypernetes做的工作contribute到Kubernetes社区，Brendan Burns大神表示很支持。</p>
<p>嗯，今天的分享就这么多。谢谢大家。</p>
<h3 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h3><ol>
<li><p>请教一下，网络呢？kuber自带那套vip全没用？</p>
<p> Kubernetes自带的功能我们都完整保留了：<br> 1⃣️ kube-proxy做的这部分功能，Hypernetes通过在每个Pod里面的Haproxy实现<br> 2⃣️service对外暴露的公网负载均衡，Hypernetes通过Neutron的Lbaas实现</p>
</li>
<li><p>Hyper是什么</p>
<p> Hyper是一个基于Hypervisor的容器执行引擎。Hyper跟Docker相比，基于Hypervisor提供了更好的隔离性，同时还保持了Docker创建容器速度快、镜像管理方面等优点。官方网站为<a href="https://hyper.sh。" target="_blank" rel="external">https://hyper.sh。</a></p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/03/hypernetes---the-multi-tenant-kubernetes-distribution/" itemprop="url">
                  Hypernetes   The multi tenant Kubernetes distribution
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-11-04T00:00:00+08:00" content="2015-11-04">
              2015-11-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Kubernetes/" itemprop="url" rel="index">
                    <span itemprop="name">Kubernetes</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/11/03/hypernetes---the-multi-tenant-kubernetes-distribution/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/03/hypernetes---the-multi-tenant-kubernetes-distribution/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>“<a href="https://hyper.sh/blog/post/2015/07/06/the-caas-revolution.html" target="_blank" rel="external">The Caas Revolution</a>“. This is what we believe is happening today in the Cloud ecosystem. This revolution has been started by the now famous project (and company) <a href="http://www.docker.com/" target="_blank" rel="external">Docker</a>, and embraced by Cloud providers like <a href="https://cloud.google.com/container-engine/" target="_blank" rel="external">Google</a> and <a href="https://aws.amazon.com/ecs/" target="_blank" rel="external">AWS</a>.</p>
<p>However, most multi-tenant CaaS solutions today run on a public IaaS, and use fully isolated virtual machine clusters to schedule containers. This is in contrast to the solely container-based implementation provided in private CaaS deployments. The public “hybrid” VM/container isolation approach is a direct result from the shared kernel architecture in container technology.</p>
<p>Which got us thinking… do users really need to configure a cluster of full-blown virtual machines to ship containers in a secure cloud? Isn’t there a native container approach to perform true isolation?</p>
<p>When we introduced <a href="http://hyper.sh/" target="_blank" rel="external">Hyper</a>, we wanted to show that it is actually possible to run truly isolated containers applications without any guest OS configuration required. We claimed that Hyper unlocks the possibility to build app-centric secure and isolated public CaaS platform, and now want to show you its power with a real-world implementation.</p>
<p>Today, we are happy to announce <strong><a href="http://hypernetes.com" target="_blank" rel="external">Hypernetes</a>*: the Secure, Multi-tenant Kubernetes distribution</strong>.</p>
<p>Simply put:</p>
<pre><code>   Hypernetes = Bare-metal + Hyper + Kubernetes + Cinder(Ceph) + Neutron + Keystone
</code></pre><p><img src="https://github.com/hyperhq/hypernetes/raw/master/architecture.png?raw=true" alt="Hypernetes"></p>
<ul>
<li>Hyper (Hyperd) runs directly on all your bare-metal machines to provision HyperVM (with Docker images) in milliseconds</li>
<li>Within the VM, the “Hyperstart” init process is launched on top of the Hyper Kernel (or any compatible Linux kernel) to run Docker images as Pod</li>
<li>Kubelet agent runs on each bare-metal host and manages HyperVM with Hyperd’s APIs</li>
<li>The formed cluster of “Kubelets” is managed with the help of a “Kubernetes Master” server</li>
<li>Hypernetes also makes uses of several OpenStack components<ul>
<li><a href="http://docs.openstack.org/developer/keystone/" target="_blank" rel="external">Keystone</a> for identities management and authentication</li>
<li><a href="https://wiki.openstack.org/wiki/Neutron" target="_blank" rel="external">Neutron</a> for virtual networks management and isolation</li>
<li><a href="https://wiki.openstack.org/wiki/Cinder" target="_blank" rel="external">Cinder</a> + <a href="http://ceph.com/" target="_blank" rel="external">Ceph</a> for persistent storage volume management</li>
</ul>
</li>
</ul>
<p>With Hypernetes, you are ready to offer your users an easy and straightforward way to deploy their Containers in the Cloud, with a maximum level of security, efficiency, and compatibility, but without the complexity introduced by nesting the Linux containers in full-blown VMs. Indeed, Hypernetes leverages the same old secure, reliable, battle tested, robust hypervisor virtualization to natively run all of your new Container applications, maximizing the ROI of your virtual infrastructure.</p>
<p>You can check it out and try Hypernetes today as a <a href="http://github.com/hyperhq/hypernetes" target="_blank" rel="external">open-source project</a>. Please, don’t hesitate to join our <a href="http://slack.hyper.sh/" target="_blank" rel="external">Slack community</a>, <a href="https://groups.google.com/forum/#!forum/hyper-user" target="_blank" rel="external">users</a> and <a href="https://groups.google.com/forum/#!forum/hyper-dev" target="_blank" rel="external">developers</a> mailing lists if you would like to discuss about Hyper or Hypernetes with us.</p>
<p>Also, as an open-source project, we warmly welcome PR contributions and issues, directly on our <a href="https://github.com/hyperhq/hypernetes" target="_blank" rel="external">Github</a>.</p>
<p>As a last word, we are presenting Hypernetes this week at the <a href="https://www.openstack.org/summit/tokyo-2015/" target="_blank" rel="external">OpenStack Tokyo Summit</a> and <a href="http://europe-2015.dockercon.com/" target="_blank" rel="external">DockerCon Europe</a> next month. If you’re around, please come by our booth ;-)</p>
<p>From <a href="https://hyper.sh/blog/post/2015/10/27/announcing-hypernetes-the-multitenant-kubernetes-distribution.html" target="_blank" rel="external">https://hyper.sh/blog/post/2015/10/27/announcing-hypernetes-the-multitenant-kubernetes-distribution.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/03/use-kubectl-to-connect-kubernetes-cluster/" itemprop="url">
                  Use kubectl to connect kubernetes cluster
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-11-04T00:00:00+08:00" content="2015-11-04">
              2015-11-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/kubernetes/" itemprop="url" rel="index">
                    <span itemprop="name">kubernetes</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/11/03/use-kubectl-to-connect-kubernetes-cluster/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/03/use-kubectl-to-connect-kubernetes-cluster/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>kubectl</code> is the main tool to interact with Kubernetes cluster. It connects to <code>http://localhost:8080</code> with no auth by default. But how can we use <code>kubectl</code> with auth?</p>
<p>Pretty simple, just config <code>kubectl</code> with dedicated cluster:</p>
<figure class="highlight dsconfig"><table><tr><td class="code"><pre><div class="line"><span class="string">kubectl </span><span class="string">config </span><span class="built_in">set-credentials</span> <span class="string">default </span><span class="built_in">--username=username</span> <span class="built_in">--password=password</span></div><div class="line"><span class="string">kubectl </span><span class="string">config </span><span class="built_in">set-cluster</span> <span class="string">default </span><span class="built_in">--server=https://kubernetes-master:6443</span> <span class="built_in">--insecure-skip-tls-verify=true</span></div><div class="line"><span class="string">kubectl </span><span class="string">config </span><span class="built_in">set-context</span> <span class="string">default </span><span class="built_in">--cluster=default</span> <span class="built_in">--user=default</span></div><div class="line"><span class="string">kubectl </span><span class="string">config </span><span class="string">use-context </span><span class="string">default</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/qrcode.jpg"
               alt="Feisky" />
          <p class="site-author-name" itemprop="name">Feisky</p>
          <p class="site-description motion-element" itemprop="description">Notes about anything.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">95</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/feiskyer" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/feisky" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/371069890" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cnblogs.com/feisky/" target="_blank" title="博客园">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  博客园
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Feisky</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'feiskyblog';
      var disqus_identifier = 'page/8/index.html';
      var disqus_title = "";
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


  


</body>
</html>
